<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<title>副本戰鬥</title>
<link rel="icon" href="favicon.ico" />
<link href="css/style.css" rel="stylesheet"/>
<link href="css/dungeon_layer_winning.css" rel="stylesheet"/>
<link href="css/dungeon_layer.css" rel="stylesheet"/>
<style>
.section::before {
  animation: none !important;
  background: none !important;
}

/* 優化的詳細說明容器 - 消除空格問題 */
.stat-item-container {
  position: relative;
  margin: 0;
  padding: 0;
}

.stat-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 8px 0;
  padding: 8px 12px;
  background: rgba(0, 255, 255, 0.05);
  border: 1px solid rgba(0, 255, 255, 0.1);
  border-radius: 6px;
  font-family: 'Orbitron', sans-serif;
  font-weight: 600;
  font-size: 0.9em;
  transition: all 0.3s ease;
  cursor: pointer;
  position: relative;
}

.stat-item:hover {
  background: rgba(0, 255, 255, 0.1);
  border-color: rgba(0, 255, 255, 0.3);
  transform: translateX(3px);
}

.stat-item span:first-child {
  color: #ffd93d;
  text-shadow: 0 0 5px rgba(255, 217, 61, 0.5);
  flex: 1;
}

.stat-item span:last-child {
  color: #00ffff;
  text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
  font-weight: 700;
  text-align: right;
}

/* 詳細說明容器 - 零空隙設計 */
.stat-detail {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  background: linear-gradient(135deg, rgba(0, 255, 255, 0.08), rgba(0, 255, 255, 0.02));
  border-radius: 0 0 6px 6px;
  margin: 0;
  border-left: 3px solid rgba(0, 255, 255, 0.3);
  border-right: 1px solid rgba(0, 255, 255, 0.1);
  border-bottom: 1px solid rgba(0, 255, 255, 0.1);
  /* 負邊距消除間隙 */
  margin-top: -1px;
  border-top: none;
}

.stat-detail.expanded {
  max-height: 200px;
}

.stat-detail-content {
  padding: 12px 15px;
  font-size: 0.75em;
  color: #b8e6ff;
  line-height: 1.5;
  text-shadow: 0 0 3px rgba(184, 230, 255, 0.6);
  margin: 0;
  /* 確保內容不會在收起時顯示 */
  opacity: 0;
  transform: translateY(-10px);
  transition: opacity 0.3s ease 0.1s, transform 0.3s ease 0.1s;
}

.stat-detail.expanded .stat-detail-content {
  opacity: 1;
  transform: translateY(0);
}

/* 怪物屬性詳細說明 - 零空隙設計 */
.monster-stat-container {
  position: relative;
  margin: 0;
}

.monster-stat-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 10px;
  background: rgba(255, 107, 107, 0.1);
  border: 1px solid rgba(255, 107, 107, 0.2);
  border-radius: 6px;
  font-family: 'Orbitron', sans-serif;
  font-weight: 600;
  font-size: 0.85em;
  transition: all 0.3s ease;
  margin: 6px 0;
  cursor: pointer;
}

.monster-stat-item:hover {
  background: rgba(255, 107, 107, 0.2);
  border-color: rgba(255, 107, 107, 0.4);
  transform: translateX(3px);
}

.monster-stat-item span:first-child {
  color: #ffd93d;
  text-shadow: 0 0 5px rgba(255, 217, 61, 0.5);
}

.monster-stat-item span:last-child {
  color: #fff8b0;
  text-shadow: 0 0 5px rgba(255, 107, 107, 0.5);
  font-weight: 700;
}

.monster-element-detail {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  background: linear-gradient(135deg, rgba(255, 107, 107, 0.08), rgba(255, 107, 107, 0.02));
  border-radius: 0 0 6px 6px;
  border-left: 3px solid rgba(255, 107, 107, 0.4);
  border-right: 1px solid rgba(255, 107, 107, 0.2);
  border-bottom: 1px solid rgba(255, 107, 107, 0.2);
  margin-top: -1px;
  border-top: none;
}

.monster-element-detail.expanded {
  max-height: 300px;
}

.monster-element-detail-content {
  padding: 12px 15px;
  font-size: 0.8em;
  color: #ffd1d1;
  line-height: 1.5;
  text-shadow: 0 0 3px rgba(255, 209, 209, 0.3);
  white-space: pre-line;
  opacity: 0;
  transform: translateY(-10px);
  transition: opacity 0.3s ease 0.1s, transform 0.3s ease 0.1s;
}

.monster-element-detail.expanded .monster-element-detail-content {
  opacity: 1;
  transform: translateY(0);
}

/* BOSS模式適配 */
body.boss-mode .monster-stat-item {
  background: rgba(255, 69, 0, 0.15);
  border-color: rgba(255, 69, 0, 0.3);
}

body.boss-mode .monster-stat-item:hover {
  background: rgba(255, 69, 0, 0.25);
  border-color: rgba(255, 69, 0, 0.5);
}

body.boss-mode .monster-stat-item span:last-child {
  color: #ffd700;
  text-shadow: 0 0 6px rgba(255, 215, 0, 0.8);
}

body.boss-mode .monster-element-detail {
  background: linear-gradient(135deg, rgba(255, 69, 0, 0.1), rgba(255, 69, 0, 0.05));
  border-left-color: rgba(255, 69, 0, 0.5);
}

body.boss-mode .monster-element-detail-content {
  color: #ffb84d;
  text-shadow: 0 0 5px rgba(255, 184, 77, 0.4);
}

/* 展開控制按鈕 */
.detail-toggle-btn {
  background: rgba(0, 255, 255, 0.1);
  border: 1px solid rgba(0, 255, 255, 0.3);
  border-radius: 8px;
  padding: 8px 16px;
  font-size: 0.8em;
  color: #00ffff;
  cursor: pointer;
  transition: all 0.3s ease;
  font-family: 'Orbitron', sans-serif;
  font-weight: 600;
  margin-bottom: 15px;
  display: block;
  width: fit-content;
  margin-left: auto;
  margin-right: auto;
}

.detail-toggle-btn:hover {
  background: rgba(0, 255, 255, 0.2);
  transform: scale(1.05);
  box-shadow: 0 0 12px rgba(0, 255, 255, 0.4);
}

.detail-toggle-btn.active {
  background: rgba(0, 255, 255, 0.3);
  box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
  border-color: rgba(0, 255, 255, 0.6);
}

/* 展開指示器 */
.expand-indicator {
  margin-left: 8px;
  transition: transform 0.3s ease;
  font-size: 0.8em;
}

.stat-detail.expanded ~ .stat-item .expand-indicator,
.monster-element-detail.expanded ~ .monster-stat-item .expand-indicator {
  transform: rotate(180deg);
}

/* 響應式設計 */
@media (max-width: 768px) {
  .detail-toggle-btn {
    padding: 6px 12px;
    font-size: 0.7em;
  }
  
  .stat-detail-content,
  .monster-element-detail-content {
    font-size: 0.7em;
    padding: 10px 12px;
  }
  
  .stat-detail.expanded {
    max-height: 150px;
  }
  
  .monster-element-detail.expanded {
    max-height: 250px;
  }
}

/* 消除所有可能的間隙 */
.stats-container > *,
.monster-stats > * {
  margin-bottom: 0;
}

.stats-container .stat-item-container:not(:last-child),
.monster-stats .monster-stat-container:not(:last-child) {
  margin-bottom: 8px;
}

/* 確保展開內容不會影響其他元素 */
.stat-item-container,
.monster-stat-container {
  isolation: isolate;
}
</style>
</head>
<body>
<!-- 勝利特效遮罩 -->
<div id="victoryOverlay" class="victory-overlay">
  <div class="fireworks" id="fireworksContainer"></div>
  <div class="victory-content">
    <div class="victory-icon">🏆</div>
    <div class="victory-title">Victory</div>
    <div class="victory-message">🌟成功通關副本🌟</div>
    <button class="effect-button" onclick="hideVictoryEffect()">繼續</button>
  </div>
</div>

<!-- 失敗特效遮罩 -->
<div id="defeatOverlay" class="defeat-overlay">
  <div class="debris" id="debrisContainer"></div>
  <div class="defeat-content">
    <div class="defeat-icon">💀</div>
    <div class="defeat-title">戰敗</div>
    <div class="defeat-message" id="defeatMessage">失敗乃成功之母，再接再厲！</div>
    <button class="effect-button" onclick="hideDefeatEffect()">繼續</button>
  </div>
</div>

<!-- 頁面載入遮罩 -->
<div id="loadingOverlay">
<div class="particles" id="pageParticles"></div>
<div class="battle-loading-container">
<div class="battle-icon">🏰</div>
<div class="battle-title normal-title">進入副本</div>
<div class="loading-text" id="pageLoadingText">正在載入副本資料...</div>
<div class="progress-container">
<div class="progress-bar" id="pageProgressBar"></div>
</div>
<div class="progress-text" id="pageProgressText">0%</div>
<div class="battle-tips">
        🗡️ 升級卡片通關會更容易！<br/>
        📊 記得配置能力點與技能！
      </div>
</div>
</div>

<!-- 戰鬥載入遮罩 -->
<div id="battleLoadingOverlay">
<div class="particles" id="particles"></div>
<div class="battle-loading-container">
<div class="battle-icon" id="battleIcon">⚔️</div>
<div class="battle-title" id="battleTitle">戰鬥準備中</div>
<div class="loading-text" id="loadingText">正在分析戰況...</div>
<div class="progress-container" id="progressContainer">
<div class="progress-bar" id="progressBar"></div>
</div>
<div class="progress-text" id="progressText">0%</div>
<div class="battle-tips" id="battleTips">
        💡 戰鬥小提示：善用屬性克制關係可以提高勝率！<br/>
        🛡️ 記得切換不同技能來應對不同關卡
      </div>
</div>
</div>

<div id="content">
<div class="section" id="userInfo">🧍 角色資訊載入中...</div>
<div class="section" id="monsterInfo">👹 怪物資訊載入中...</div>
<div class="section"><strong>📜 戰鬥紀錄</strong><pre id="logArea"></pre></div>
</div>

<div id="footer">
<button id="battleBtn" onclick="startBattle()">開始戰鬥</button>
<button id="retryBtn" style="display:none" onclick="retryBattle()">再戰一次</button>
<button id="nextBtn" style="display:none">下一層</button>
<button id="leaveBtn" onclick="leaveDungeon()" style="display:none">離開副本</button>
</div>

<script>
function percent(val) {
  return (val * 100).toFixed(1) + '%';
}

// 頁面載入粒子效果
(function() {
  function createPageParticles() {
    const particlesContainer = document.getElementById("pageParticles");
    if (!particlesContainer) return;
    particlesContainer.innerHTML = "";
    for (let i = 0; i < 30; i++) {
      const particle = document.createElement("div");
      particle.className = "particle";
      particle.style.left = Math.random() * 100 + "%";
      particle.style.animationDelay = Math.random() * 4 + "s";
      particle.style.animationDuration = (Math.random() * 2 + 3) + "s";
      particle.style.background = `rgba(${Math.random() > 0.5 ? '56, 239, 125' : '17, 153, 142'}, 0.7)`;
      particlesContainer.appendChild(particle);
    }
  }

  function startPageLoadingProgress() {
    const progressBar = document.getElementById("pageProgressBar");
    const progressText = document.getElementById("pageProgressText");
    const loadingText = document.getElementById("pageLoadingText");
    if (!progressBar || !progressText || !loadingText) return;

    const messages = [
      "正在載入副本資料...",
      "獲取玩家狀態...",
      "載入怪物資訊...",
      "準備戰鬥環境...",
      "載入完成！"
    ];

    let progress = 0;
    let messageIndex = 0;
    const progressInterval = setInterval(() => {
      progress += Math.random() * 20 + 10;
      if (progress > 100) progress = 100;

      progressBar.style.width = progress + "%";
      progressText.textContent = Math.round(progress) + "%";

      if (messageIndex < messages.length - 1 && progress > (messageIndex + 1) * 20) {
        messageIndex++;
        loadingText.textContent = messages[messageIndex];
      }

      if (progress >= 100) {
        clearInterval(progressInterval);
        loadingText.textContent = messages[messages.length - 1];
      }
    }, 300);

    window.pageLoadingInterval = progressInterval;
  }

  createPageParticles();
  startPageLoadingProgress();
})();

// 詳細說明狀態
let detailsExpanded = false;

// 詳細說明 tooltips
const tooltips = {
  level: "角色的當前等級。等級差距會影響戰鬥傷害：最多7等差距時傷害變為1.5倍或0.5倍。",
  exp: "角色的經驗值與升級進度。透過戰鬥獲得經驗值，累積足夠經驗值後會自動升級。不同怪物給予的經驗值不同，高等級怪物給予更多經驗值。",
  hp: "玩家的總生命值，決定角色的生存能力。當生命值降至0時戰鬥失敗。",
  attack: "決定對敵人造成傷害的基礎數值。攻擊力越高，傷害越大。會受到屬性克制、技能倍率、等級差距等因素影響。",
  shield: "減少受到傷害的防護值。每點護盾值減少0.1%傷害，最多99%。可透過護盾穿透降低效果，提供穩定的傷害減免。",
  luck: "影響迴避率、物品掉落率的幸運值。每點幸運提供額外0.2%迴避率加成(不直接顯示在迴避率上)，同時提升物品掉落及額外掉落機率。",
  accuracy: "攻擊命中敵人的機率，會與敵人迴避率相抗(命中率-迴避率)。命中率不足會導致失去本次攻擊傷害。",
  evade: "閃避敵人攻擊的機率，數值越高越容易完全無視敵人的攻擊，最高99%。迴避成功時完全無視該次攻擊傷害。",
  atk_speed: "決定戰鬥中的出手順序與頻率。攻擊速度高的一方會優先行動，並可能在一回合內進行多次攻擊。速度差距越大，優勢方的行動次數越多。並且進而加快技能冷卻回合。",
  other_bonus: "額外傷害加成，按百分比增加最終傷害。這是一個倍率加成，會在所有其他計算完成後套用。",
  penetrate: "無視敵人護盾值的能力。穿透值會直接扣除敵人的有效護盾值，是突破高防禦敵人的關鍵屬性。每點穿透可無視1點敵人護盾。",
  stat_points: "可用於提升基礎能力值的點數。每升級獲得5點。可分配到生命值(+5/點)、攻擊力(+1/點)或幸運值(+1/點)。",
  skill_points: "可用於升級技能的點數。每升級獲得3點。"
};

// 屬性克制說明生成
function generateElementDescription(elements) {
  const descriptions = [];
  
  elements.forEach(element => {
    switch(element) {
      case "pyro":
      case "火":
        descriptions.push("🔥 火屬性");
        descriptions.push("優勢：水屬性、全屬性 (+25% 傷害)");
        descriptions.push("劣勢：自然屬性 (-25% 傷害)");
        break;
      case "hydro":
      case "水":
        descriptions.push("💧 水屬性");
        descriptions.push("優勢： 雷屬性、全屬性 (+25% 傷害)");
        descriptions.push("劣勢： 火屬性 (-25% 傷害)");
        break;
      case "electro":
      case "雷":
        descriptions.push("⚡ 雷屬性");
        descriptions.push("優勢：自然屬性、全屬性 (+25% 傷害)");
        descriptions.push("劣勢：水屬性 (-25% 傷害)");
        break;
      case "nature":
      case "自然":
        descriptions.push("🌿 自然屬性");
        descriptions.push("優勢：火屬性、全屬性 (+25% 傷害)");
        descriptions.push("劣勢：雷屬性 (-25% 傷害)");
        break;
      case "light":
      case "光":
        descriptions.push("✨ 光屬性");
        descriptions.push("優勢：暗屬性、全屬性 (+25% 傷害)");
        break;
      case "dark":
      case "暗":
        descriptions.push("🌑 暗屬性");
        descriptions.push("優勢：光屬性、全屬性 (+25% 傷害)");
        break;
      case "all":
      case "全":
        descriptions.push("🌟 全屬性");
        descriptions.push("  └ 劣勢：其他屬性 (-25% 傷害)");
        break;
      case "none":
      case "無":
        descriptions.push("⚪ 無屬性");
        descriptions.push("優勢：全屬性 (+25% 傷害)");
        break;
      default:
        descriptions.push(`${elementMap[element] || element}屬性`);
    }
  });
  
  if (elements.length > 1) {
    descriptions.push("");
    descriptions.push("【複數屬性機制】");
    descriptions.push("• 擁有多個屬性時，傷害計算將取所有屬性克制關係平均值");
    descriptions.push("• 例如：火水雙屬性怪物被雷屬性攻擊時");
    descriptions.push("  - 雷→火：100%傷害(無克制)");
    descriptions.push("  - 雷→水：125%傷害(克制)");
    descriptions.push("  - 最終傷害：(100% + 125%) ÷ 2 = 112.5%");
  }
  
  return descriptions.join("\n");
}

// 詳細說明展開/收起控制
function toggleDetails() {
  detailsExpanded = !detailsExpanded;
  const button = document.querySelector('.detail-toggle-btn');
  
  if (button) {
    button.textContent = detailsExpanded ? '收起詳細說明' : '顯示詳細說明';
    button.classList.toggle('active', detailsExpanded);
  }
  
  // 控制玩家詳細說明
  const playerDetails = document.querySelectorAll('.stat-detail');
  playerDetails.forEach(detail => {
    detail.classList.toggle('expanded', detailsExpanded);
  });
  
  // 控制怪物屬性詳細說明
  const monsterDetail = document.querySelector('.monster-element-detail');
  if (monsterDetail) {
    monsterDetail.classList.toggle('expanded', detailsExpanded);
  }
}

// 設定全域函數
window.toggleDetails = toggleDetails;

// 模擬的遊戲資料和函數（這裡需要根據你的實際實現來調整）
const elementMap = {
  "none": "無",
  "phy": "物理", 
  "pyro": "火",
  "hydro": "水",
  "electro": "雷",
  "nature": "自然",
  "light": "光",
  "dark": "暗",
  "all": "全"
};

// 模擬格式化玩家狀態
function formatStats(data) {
  const b = data.base_stats;
  const e = data.equipment_bonus || {};
  
  const getValue = (key) => (b[key] || 0) + (e[key] || 0);
  const getFormatted = (key) => {
    const isPercent = ["evade", "accuracy", "other_bonus"].includes(key);
    const total = getValue(key);
    const base = b[key] || 0;
    const bonus = e[key] || 0;
    
    if (isPercent) {
      return {
        total: `${percent(total)}`,
        detail: `${percent(base)} + ${percent(bonus)}`
      };
    } else {
      return {
        total: total.toString(),
        detail: `${base} + ${bonus}`
      };
    }
  };

  const statsList = [
    { key: "level", label: "等級", value: data.level },
    { key: "exp", label: "經驗值", value: `${data.exp} (${percent(data.exp / 1000)})` },
    { key: "hp", label: "生命值" },
    { key: "attack", label: "攻擊力" },
    { key: "shield", label: "護盾值" },
    { key: "luck", label: "幸運值" },
    { key: "accuracy", label: "命中率" },
    { key: "evade", label: "迴避率" },
    { key: "atk_speed", label: "攻擊速度" },
    { key: "other_bonus", label: "額外傷害加成" },
    { key: "penetrate", label: "護盾穿透" },
    { key: "stat_points", label: "剩餘能力值點數", value: data.stat_points },
    { key: "skill_points", label: "剩餘技能點", value: data.skill_points }
  ];

  let html = `
    <div class="player-info-container">
      <button class="detail-toggle-btn" onclick="toggleDetails()">${detailsExpanded ? '收起詳細說明' : '顯示詳細說明'}</button>
      <h3 class="player-name">👤 ${data.nickname}</h3>
      <div class="stats-container">
  `;
  
  statsList.forEach(({ key, label, value }) => {
    html += `<div class="stat-item-container">`;
    
    if (value !== undefined) {
      html += `<div class="stat-item">
                 <span>${label}:</span>
                 <span>${value}</span>
               </div>`;
    } else if (["hp", "attack", "shield", "penetrate", "luck", "accuracy", "evade", "atk_speed", "other_bonus"].includes(key)) {
      const formatted = getFormatted(key);
      html += `<div class="stat-item">
                 <span>${label}:</span>
                 <span>${formatted.total} (${formatted.detail})</span>
               </div>`;
    }
    
    if (tooltips[key]) {
      html += `<div class="stat-detail ${detailsExpanded ? 'expanded' : ''}">
                 <div class="stat-detail-content">${tooltips[key]}</div>
               </div>`;
    }
    
    html += `</div>`;
  });
  
  html += '</div></div>';
  return html;
}

// 模擬格式化怪物資訊
function formatMonsterInfo(mon, isLastLayer) {
  const description = (mon.info || '').replace(/\/n/g, '\n');
  
  const elementText = Array.isArray(mon.element) 
    ? mon.element.map(e => elementMap[e] || e).join("、") 
    : (elementMap[mon.element] || mon.element);

  let containerClass = "monster-info-container";
  let bossTitle = "";
  
  if (isLastLayer) {
    containerClass += " boss";
    bossTitle = '<div class="boss-title-decoration">BOSS</div>';
  }

  const monsterPenetrate = mon.stats.penetrate || 0;
  const elements = Array.isArray(mon.element) ? mon.element : [mon.element];
  const elementDescription = generateElementDescription(elements);

  const html = `
    <div class="${containerClass}">
      ${bossTitle}
      <h2 class="monster-name">${mon.name}</h2>
      <img src="${mon.image_url}" class="monster-image" width="200">
      <div class="monster-description">${description}</div>
      <div class="monster-stats">
        <div class="monster-stat-container">
          <div class="monster-stat-item">
            <span>等級：</span>
            <span>${mon.level}</span>
          </div>
        </div>
        <div class="monster-stat-container">
          <div class="monster-stat-item">
            <span>屬性：</span>
            <span>${elementText}</span>
          </div>
          <div class="monster-element-detail ${detailsExpanded ? 'expanded' : ''}">
            <div class="monster-element-detail-content">${elementDescription}</div>
          </div>
        </div>
        <div class="monster-stat-container">
          <div class="monster-stat-item">
            <span>生命值：</span>
            <span>${mon.stats.hp}</span>
          </div>
        </div>
        <div class="monster-stat-container">
          <div class="monster-stat-item">
            <span>攻擊力：</span>
            <span>${mon.stats.attack}</span>
          </div>
        </div>
        <div class="monster-stat-container">
          <div class="monster-stat-item">
            <span>護盾值：</span>
            <span>${mon.stats.shield}</span>
          </div>
        </div>
        <div class="monster-stat-container">
          <div class="monster-stat-item">
            <span>命中率：</span>
            <span>${Math.round(mon.stats.accuracy * 100)}%</span>
          </div>
        </div>
        <div class="monster-stat-container">
          <div class="monster-stat-item">
            <span>迴避率：</span>
            <span>${Math.round(mon.stats.evade * 100)}%</span>
          </div>
        </div>
        <div class="monster-stat-container">
          <div class="monster-stat-item">
            <span>攻擊速度：</span>
            <span>${mon.stats.atk_speed}</span>
          </div>
        </div>
        <div class="monster-stat-container">
          <div class="monster-stat-item">
            <span>護盾穿透：</span>
            <span>${monsterPenetrate}</span>
          </div>
        </div>
      </div>
    </div>
  `;
  
  return html;
}

// 示例資料用於展示
const sampleUserData = {
  nickname: "測試玩家",
  level: 25,
  exp: 750,
  stat_points: 5,
  skill_points: 3,
  base_stats: {
    hp: 150,
    attack: 45,
    shield: 20,
    luck: 15,
    accuracy: 0.85,
    evade: 0.15,
    atk_speed: 110,
    other_bonus: 0.1,
    penetrate: 5
  },
  equipment_bonus: {
    hp: 30,
    attack: 15,
    shield: 10,
    luck: 5,
    accuracy: 0.05,
    evade: 0.02,
    other_bonus: 0.05,
    penetrate: 2
  }
};

const sampleMonsterData = {
  name: "沼澤之王",
  image_url: "https://via.placeholder.com/200x200?text=Monster",
  element: ["hydro", "nature"],
  level: 30,
  info: "統治沼澤地的強大生物，擁有水與自然的雙重力量。",
  stats: {
    hp: 2500,
    attack: 80,
    shield: 50,
    accuracy: 0.9,
    evade: 0.1,
    atk_speed: 95,
    penetrate: 8
  }
};

// 初始化示例顯示
setTimeout(() => {
  document.getElementById('userInfo').innerHTML = formatStats(sampleUserData);
  document.getElementById('monsterInfo').innerHTML = formatMonsterInfo(sampleMonsterData, false);
  
  // 隱藏載入畫面
  const loading = document.getElementById('loadingOverlay');
  if (loading) {
    loading.style.display = 'none';
  }
}, 2000);

// 模擬特效函數
function hideVictoryEffect() {
  document.getElementById("victoryOverlay").style.display = "none";
}

function hideDefeatEffect() {
  document.getElementById("defeatOverlay").style.display = "none";
}

function leaveDungeon() {
  alert("離開副本");
}

function startBattle() {
  alert("開始戰鬥");
}

function retryBattle() {
  alert("再戰一次");
}

window.hideVictoryEffect = hideVictoryEffect;
window.hideDefeatEffect = hideDefeatEffect;
window.leaveDungeon = leaveDungeon;
window.startBattle = startBattle;
window.retryBattle = retryBattle;
</script>
</body>
</html>
