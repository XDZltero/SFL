<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>èƒŒåŒ…èˆ‡è£å‚™</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #userInfo { margin-bottom: 1em; }

    #container {
      display: flex;
      gap: 40px;
    }

    #equipped, #items {
      border: 1px solid #ccc;
      padding: 1em;
      flex: 1;
      min-height: 300px;
    }

    h2 { margin-top: 0; }
    input, button { padding: 6px; margin: 5px; }
  </style>
</head>
<body>
  <h1>ğŸ’ èƒŒåŒ…èˆ‡è£å‚™ç®¡ç†</h1>

  <div>
    ä½¿ç”¨è€… IDï¼š<input id="userId" placeholder="è¼¸å…¥ä½¿ç”¨è€… ID" />
    <button onclick="loadInventory()">è¼‰å…¥è³‡æ–™</button>
  </div>

  <div id="userInfo">(å°šæœªè¼‰å…¥)</div>

  <div id="container">
    <div id="equipped">
      <h2>ğŸ›¡ï¸ è£å‚™ä¸­</h2>
      <pre id="equipBlock">å°šæœªè¼‰å…¥</pre>
    </div>
    <div id="items">
      <h2>ğŸ“¦ èƒŒåŒ…å…§å®¹</h2>
      <pre id="itemBlock">å°šæœªè¼‰å…¥</pre>
    </div>
  </div>

  <script>
    const API_BASE = "https://sfl-9cb8.onrender.com";

    function getUser() {
      return document.getElementById("userId").value.trim();
    }

    async function loadInventory() {
      const user = getUser();
      if (!user) return alert("è«‹è¼¸å…¥ä½¿ç”¨è€… ID");

      // æŸ¥è©¢è§’è‰²åŸºæœ¬ç‹€æ…‹
      const res1 = await fetch(`${API_BASE}/status?user=${user}`);
      const userData = await res1.json();

      if (userData.error) {
        document.getElementById("userInfo").innerText = "âŒ ç„¡æ³•å–å¾—è§’è‰²è³‡è¨Š";
        return;
      }

      // é¡¯ç¤ºè§’è‰²åŸºæœ¬è³‡è¨Š
      let info = `ğŸ§ ä½¿ç”¨è€…ï¼š${userData.nickname || user}\n`;
      info += `ğŸ”¢ ç­‰ç´šï¼š${userData.level}ï¼ˆEXP: ${userData.exp}ï¼‰\n`;
      info += `ğŸ’ª èƒ½åŠ›ï¼š\n`;
      for (const [k, v] of Object.entries(userData.base_stats || {})) {
        info += `  - ${k.toUpperCase()}ï¼š${v}\n`;
      }
      document.getElementById("userInfo").innerText = info;

      // é¡¯ç¤ºè£å‚™ä¸­å…§å®¹
      let equipText = "";
      for (const [slot, item] of Object.entries(userData.equipment || {})) {
        equipText += `  - ${slot}ï¼š${item || "ç„¡"}\n`;
      }
      document.getElementById("equipBlock").innerText = equipText;

      // æŸ¥è©¢èƒŒåŒ…è³‡æ–™
      const res2 = await fetch(`${API_BASE}/inventory?user=${user}`);
      const inv = await res2.json();
      const items = inv.items || {};

      let itemText = "";
      for (const [name, count] of Object.entries(items)) {
        itemText += `  - ${name} x ${count}\n`;
      }

      document.getElementById("itemBlock").innerText = itemText || "ï¼ˆç„¡ç‰©å“ï¼‰";
    }
  </script>
</body>
</html>
